<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Go Game</title>
    <style>
        .board {
            width: 570px;
            height: 570px;
            border: 1px solid #000;
            position: relative;
            background-color: #DDC;
            margin: 30px;
        }

        .line {
            position: absolute;
            background-color: #000;
        }

        .stone {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .black {
            background-color: #000;
        }

        .white {
            background-color: #fff;
            border: 1px solid #000;
        }
    </style>
</head>
<body>
    <div class="board" id="board"></div>

    <script>
        class UnionFind {
            constructor() {
                this.parent = {};
                this.rank = {};
                this.liberties = {};
                this.color = {};
            }

            find(x) {
                if (this.parent[x] !== x) {
                    this.parent[x] = this.find(this.parent[x]);
                }
                return this.parent[x];
            }

            union(x, y) {
                var rootX = this.find(x);
                var rootY = this.find(y);
                if (rootX === rootY) return;
                if (this.rank[rootX] > this.rank[rootY]) {
                    this.parent[rootY] = rootX;
                    this.liberties[rootX] += this.liberties[rootY];
                } else {
                    this.parent[rootX] = rootY;
                    this.liberties[rootY] += this.liberties[rootX];
                    if (this.rank[rootX] === this.rank[rootY]) {
                        this.rank[rootY]++;
                    }
                }
            }

            addStone(x, y, color, neighbors) {
    var id = x + ',' + y;
    this.parent[id] = id;
    this.rank[id] = 0;
    this.liberties[id] = 0;  // Initialize liberties to 0
    this.color[id] = color;
    for (var neighbor of neighbors) {
        var neighborId = neighbor.join(',');
        if (!boardState[neighbor[0]][neighbor[1]]) {
            this.liberties[id]++;  // Increment liberties for each empty neighbor
        } else if (this.parent[neighborId]) {
            this.union(id, neighborId);
        }
    }
}


            removeGroup(x, y) {
                var root = this.find(x + ',' + y);
                for (var id in this.parent) {
                    if (this.find(id) === root) {
                        delete this.parent[id];
                        var coordinates = id.split(',');
                        var x = parseInt(coordinates[0]);
                        var y = parseInt(coordinates[1]);
                        var stone = document.querySelector('.stone[style*="top: ' + (x * cellSize) + 'px"][style*="left: ' + (y * cellSize) + 'px"]');
                        if (stone) board.removeChild(stone);
                    }
                }
            }
        }

        var boardSize = 19;
        var cellSize = 30;
        var board = document.getElementById('board');
        var currentPlayer = 'black';
        var boardState = [];
        var lastBoardState = null;
        var lastMoveKo = null;
        var uf = new UnionFind();

        /* ... existing setup code ... */

        for (var i = 0; i < boardSize; i++) {
            boardState[i] = [];
            for (var j = 0; j < boardSize; j++) {
                boardState[i][j] = null;
                // Drawing the board lines
                if (j === 0) {
                    var verticalLine = document.createElement('div');
                    verticalLine.className = 'line';
                    verticalLine.style.width = '1px';
                    verticalLine.style.height = (boardSize * cellSize) + 'px';
                    verticalLine.style.left = (i * cellSize) + 'px';
                    verticalLine.style.top = '0';
                    board.appendChild(verticalLine);
                }
                
                if (i === 0) {
                    var horizontalLine = document.createElement('div');
                    horizontalLine.className = 'line';
                    horizontalLine.style.height = '1px';
                    horizontalLine.style.width = (boardSize * cellSize) + 'px';
                    horizontalLine.style.top = (j * cellSize) + 'px';
                    horizontalLine.style.left = '0';
                    board.appendChild(horizontalLine);
                }
            }
        }
        
        board.addEventListener('click', function (e) {
            var rect = board.getBoundingClientRect();
            var x = e.clientX - rect.left;
            var y = e.clientY - rect.top;
            var i = Math.floor(y / cellSize);
            var j = Math.floor(x / cellSize);
            placeStone(i, j, currentPlayer);
        });

        function getNeighbors(x, y) {
            var neighbors = [];
            if (x > 0) neighbors.push([x - 1, y]);
            if (x < boardSize - 1) neighbors.push([x + 1, y]);
            if (y > 0) neighbors.push([x, y - 1]);
            if (y < boardSize - 1) neighbors.push([x, y + 1]);
            return neighbors;
        }

        function getStoneColor(position) {
            var x = position[0];
            var y = position[1];
            return boardState[x][y];
        }

        function placeStone(x, y, color) {
            if (boardState[x][y] !== null) return;
            var koPosition = x + ',' + y;
            if (lastMoveKo === koPosition) return;  // Prevent Ko

            var neighbors = getNeighbors(x, y);
            uf.addStone(x, y, color, neighbors);

            var stone = document.createElement('div');
            stone.className = 'stone ' + color;
            stone.style.top = (x * cellSize) + 'px';
            stone.style.left = (y * cellSize) + 'px';
            board.appendChild(stone);

            boardState[x][y] = color;

            var captured = false;
            var singleCapture = false;
            var capturedPosition = null;
            for (var neighbor of neighbors) {
                var neighborColor = getStoneColor(neighbor);
                if (neighborColor && neighborColor !== color) {
                    var root = uf.find(neighbor.join(','));
                    if (uf.liberties[root] === 0) {
                        uf.removeGroup(neighbor[0], neighbor[1]);
                        captured = true;
                        singleCapture = !singleCapture;  // Toggle for each capture
                        capturedPosition = neighbor;
                    }
                }
            }

            var selfRoot = uf.find(x + ',' + y);
            if (!captured && uf.liberties[selfRoot] === 0) {
                // No-suicide rule: remove the placed stone
                uf.removeGroup(x, y);
                return;
            }

            lastMoveKo = singleCapture ? capturedPosition.join(',') : null;

            currentPlayer = (color === 'black') ? 'white' : 'black';
        }
    </script>
</body>
</html>
    
